# 机器人学基础概念

> 本章介绍机器人学中最基础的概念：运动学与动力学。这些是理解机器人运动控制的基础。

## 1. 机器人学概述

### 1.1 什么是机器人学？

机器人学（Robotics）是研究机器人设计、制造、运行和应用的跨学科领域。

```
┌─────────────────────────────────────────────────────────┐
│                      机器人系统                           │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌────────┐ │
│  │  感知   │ -> │  决策   │ -> │  控制   │ -> │  执行  │ │
│  │ Sensors │    │  Plan   │    │ Control │    │  Act   │ │
│  └─────────┘    └─────────┘    └─────────┘    └────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 1.2 机器人关节类型

| 关节类型 | 描述 | 自由度 |
|----------|------|--------|
| 旋转关节 (Revolute) | 绕轴旋转 | 1 DOF |
| 移动关节 (Prismatic) | 沿轴平移 | 1 DOF |
| 球关节 (Spherical) | 3D旋转 | 3 DOF |

## 2. 运动学基础

### 2.1 刚体变换

**齐次变换矩阵** 用于描述刚体在3D空间中的位姿：

$$
T = \begin{bmatrix}
R & p \\
0 & 1
\end{bmatrix}
$$

其中：
- $R$ 是 $3 \times 3$ 旋转矩阵
- $p$ 是 $3 \times 1$ 位置向量

### 2.2 旋转表示

#### 欧拉角
绕三个坐标轴的旋转序列：
- Roll (滚转): 绕 x 轴
- Pitch (俯仰): 绕 y 轴  
- Yaw (偏航): 绕 z 轴

#### 四元数
解决万向节锁问题：

$$
q = w + xi + yj + zk = [w, x, y, z]
$$

**优点**：
- 紧凑（4个参数）
- 无奇异性
- 易于插值

### 2.3 正运动学

**定义**：已知关节角度，求末端执行器位姿

```
关节角度 (θ1, θ2, θ3) → 末端位姿 (位置 + 姿态)
```

**DH参数表示法**：
| 参数 | 描述 |
|------|------|
| $a_i$ | 连杆长度 |
| $\alpha_i$ | 连杆扭角 |
| $d_i$ | 连杆偏距 |
| $\theta_i$ | 关节角 |

**代码示例**：
```python
import numpy as np

def forward_kinematics_dh(theta, dh_params):
    """
    使用DH参数计算正运动学
    theta: 关节角度列表
    dh_params: DH参数 (a, alpha, d)
    """
    T = np.eye(4)
    for i, (t, (a, alpha, d)) in enumerate(zip(theta, dh_params)):
        ct = np.cos(t)
        st = np.sin(t)
        ca = np.cos(alpha)
        sa = np.sin(alpha)
        
        Ti = np.array([
            [ct, -st*ca,  st*sa, a*ct],
            [st,  ct*ca, -ct*sa, a*st],
            [0,   sa,     ca,     d   ],
            [0,   0,      0,      1   ]
        ])
        T = T @ Ti
    return T

# 2关节机械臂示例
dh_params = [(1, 0, 0), (1, 0, 0)]  # a, alpha, d
theta = [np.pi/4, np.pi/4]
T = forward_kinematics_dh(theta, dh_params)
print("末端位姿:\n", T)
```

### 2.4 逆运动学

**定义**：已知末端执行器位姿，求关节角度

```
末端位姿 (位置 + 姿态) → 关节角度 (θ1, θ2, θ3)
```

**解析法**（封闭解）：
```python
def inverse_kinematics_2link(x, y, l1, l2):
    """
    2R机械臂解析逆解
    """
    r = np.sqrt(x**2 + y**2)
    
    # 判断是否可达
    if r > l1 + l2 or r < abs(l1 - l2):
        return None
    
    # 余弦定理求关节2角度
    cos_theta2 = (r**2 - l1**2 - l2**2) / (2 * l1 * l2)
    theta2 = np.arccos(np.clip(cos_theta2, -1, 1))
    
    # 求关节1角度
    phi = np.arctan2(y, x)
    psi = np.arccos((r**2 + l1**2 - l2**2) / (2 * r * l1))
    theta1 = phi - psi
    
    return [theta1, theta2]
```

## 3. 动力学基础

### 3.1 拉格朗日力学

**拉格朗日函数**：
$$L(q, \dot{q}) = T(q, \dot{q}) - V(q)$$

- $T$: 动能
- $V$: 势能

**欧拉-拉格朗日方程**：
$$\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right) - \frac{\partial L}{\partial q_i} = \tau_i$$

### 3.2 机器人动力学方程

$$M(q)\ddot{q} + C(q, \dot{q})\dot{q} + g(q) = \tau$$

| 符号 | 含义 |
|------|------|
| $M(q)$ | 惯性矩阵 |
| $C(q, \dot{q})$ | 科里奥利/离心力矩阵 |
| $g(q)$ | 重力向量 |
| $\tau$ | 关节力矩 |

### 3.3 惯性矩阵

对于n关节机器人：
$$M(q) = \sum_{i=1}^{n} J_i^T I_i J_i$$

### 3.4 动力学代码示例

```python
def compute_dynamics(q, q_dot, q_ddot, M, C, g):
    """
    计算机器人动力学
    q: 关节位置
    q_dot: 关节速度
    q_ddot: 关节加速度
    """
    # 惯性力
    inertia_force = M @ q_ddot
    
    # 科里奥利力
    coriolis_force = C @ q_dot
    
    # 重力
    gravity_force = g
    
    # 合力矩
    tau = inertia_force + coriolis_force + gravity_force
    return tau

# 示例: 2关节动力学
M = np.array([[2, 0.5], [0.5, 1]])  # 惯性矩阵
C = np.array([[0, -0.5], [0.5, 0]])  # 科里奥利矩阵
g = np.array([0, 9.8])              # 重力

tau = compute_dynamics(
    q=np.array([0.5, 0.5]),
    q_dot=np.array([0.1, 0.1]),
    q_ddot=np.array([0, 0]),
    M=M, C=C, g=g
)
print("所需力矩:", tau)
```

## 4. 雅可比矩阵

### 4.1 定义

**雅可比矩阵** 表示关节速度与末端速度之间的线性映射：

$$
\dot{x} = J(q)\dot{q}
$$

### 4.2 速度雅可比

```python
def compute_jacobian(robot, q):
    """
    计算机器人雅可比矩阵
    """
    n = len(q)
    J = np.zeros((6, n))
    
    # 简化计算 - 实际需要基于具体机器人
    # 这里演示概念
    for i in range(n):
        # 每个关节的贡献
        zi = robot.get_axis(i, q)  # 关节轴方向
        pi = robot.get_link_origin(i, q)  # 关节位置
        pe = robot.get_end_effector(q)   # 末端位置
        
        # 线速度雅可比
        J[:3, i] = np.cross(zi, pe - pi)
        # 角速度雅可比
        J[3:, i] = zi
    
    return J
```

### 4.3 奇异性

当 $\det(J) = 0$ 时，机器人处于**奇异位姿**：
- 失去某个方向的活动能力
- 关节速度趋向无穷大

## 5. 小结

```
┌────────────────────────────────────────────────────────┐
│                    运动学 vs 动力学                       │
├────────────────────────────────────────────────────────┤
│  运动学 (Kinematics)                                    │
│  - 描述运动关系，不考虑力                                │
│  - 正运动学: 关节 -> 末端                               │
│  - 逆运动学: 末端 -> 关节                               │
├────────────────────────────────────────────────────────┤
│  动力学 (Dynamics)                                      │
│  - 描述力和运动的关系                                    │
│  - 正向: 力矩 -> 运动                                   │
│  - 逆向: 运动 -> 所需力矩                               │
└────────────────────────────────────────────────────────┘
```

## 6. 扩展阅读

- 《机器人学导论》- Craig
- 《Modern Robotics》- Lynch & Park
- ROS MoveIt! 文档

---

*下一章将介绍世界模型概念，理解智能体如何构建对世界的内部表示。*
